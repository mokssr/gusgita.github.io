<html>
    <head>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <script src="chartjs/jquery-3.3.1.min.js"></script>
    </head>
    <body>
        <!-- Plotly chart will be drawn inside this div -->
        <label for="fStock">Stock Code : </label>
        <input type="text" id="fStock" name="fStock" placeholder="e.g BBCA.JK" value="BBCA.JK">
        <input type="button" id="btnSubmit" name="btnSubmit" value="Retrieve" onclick="loadData()">
        <div id="plotly-div"></div>
        <script>
            function loadData() {
                var stockCode = document.getElementById('fStock').value;
                if (stockCode == '') alert('Masukan kode saham!');
                var hostUrl = "http://127.0.0.1:8000/";
                //var hostUrl = "https://agi-snr-api-proto.herokuapp.com/";
                var baseUrl = hostUrl + "indicator/";
                $.ajax(baseUrl + stockCode + "/", {
                    success : drawChart,
                    error : function(jqXHR, textStatus, errorThrown) {
                        alert("Error! " + textStatus + " : " + errorThrown);
                    }
                })
            }

            function drawChart(resp, textStatus, jqXHR) {
                var cdData = [getCdData(resp.data)];
                var layout = {
                    dragmode: 'zoom',
                    showlegend: false,
                    margin: {
                        r: 10, 
                        t: 25, 
                        b: 40, 
                        l: 60
                    },
                    xaxis: {
                        autorange: true,
                        title: 'Date',
                        type: 'date',
                        rangeselector: {
                            x: 0,
                            y: 1.2,
                            xanchor: 'left',
                            font: {size: 8},
                            buttons: [{
                                step: 'month',
                                stepmode: 'backward',
                                count: 1,
                                label: '1 month'
                            },
                            {
                                step: 'month',
                                stepmode: 'backward',
                                count: 6,
                                label: '6 months'
                            },
                            {
                                step: 'all',
                                label: 'All dates'
                            }]
                        }
                    },
                    yaxis: {
                        autorange: true,
                    }
                };

                Plotly.plot('plotly-div', cdData, layout);
            }

            function getCdData(data){
                var x = [];
                var close = [];
                var high = [];
                var low = [];
                var open = [];

                $.each(data, function(key, value){
                    x.push(key);
                    close.push(value.close);
                    high.push(value.high);
                    low.push(value.low);
                    open.push(value.open);
                });
                return {
                    x: x,
                    close: close,
                    high: high,
                    low: low,
                    open: open,
                    increasing: {line: {color: 'green'}},
                    decreasing: {line: {color: 'red'}},
                    type: 'candlestick',
                    xaxis: 'x',
                    yaxis: 'y'
                };
            }
        </script>
    </body>
</html>
    
    